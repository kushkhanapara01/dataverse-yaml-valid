---
version: 0.1.0
alias: Test0001
discoveryPort:
  name: Weather
  shortDescription: Weather Forecast of the next 7 days for ahmedabad city
  longDescription: Weather Forecast of the next 7 days for ahmedabad city along with
    the accuracy of the previous forecast
  tags:
  - Weather
  - Forecast
  - City
  - Geospatial
  email: user@maf.ae
  dataTimeRange:
    fromMinDataDate: '2022-04-07'
    toMinDataDate: '2022-04-14'
    timeColumn: '2022-04-07'
  industryDomain: Meteorology
  function: Forecast
  regulatoryFields:
    dataPrivacy: public
    customerInfo: nonPII
    dataOrigin: machineGenerated
    monetaryInfo: nonFinancialData
inputPorts:
- alias: test_manifest_csv
  description: string
  tags: []
  syncType: pull
  type: s3-csv
  dataSetUrn: urn:dv:dataset:6528340c-e501-44e5-9658-c5bf335f57d9
  incrementalLoad: true
  incrementalStrategy:
    frequency:
    - keyReference: timeStamp
      mode: range
      interval: -5
  entity:
    path: s3a://mafh-analytics-data-ingestion/data-ingestion/prd/parsed/rtl_crf_dim_account/
    advanceOptions:
      delimiter: "|"
    variables:
    - key: timeStamp
      value: date-YYYYMMdd
- alias: test_manifest_parquet
  description: string
  tags: []
  syncType: pull
  type: s3-parquet
  dataSetUrn: urn:dv:dataset:6528340c-e501-44e5-9658-c5bf335f57d9
  incrementalLoad: true
  incrementalStrategy:
    frequency:
    - keyReference: timeStamp
      mode: range
      interval: -5
  entity:
    path: s3a://mafh-analytics-data-ingestion/data-ingestion/prd/parsed/rtl_crf_dim_account/
    variables:
    - key: timeStamp
      value: date-YYYYMMdd
    advanceOptions:
      mergeSchema: true
productState:
  refreshInterval: 0/15 * * * *
  updateStrategy: scd2
  updateStrategyOptions:
    uniqueKeyColumns:
    - id
    changeTrackColumns:
    - marks
    timeTrackColumn: modified
  logicalSchema:
    schemaDefinition:
    - version: 1
      structure:
        properties:
          brand:
            type: string
          model:
            type: string
          engine:
            type: string
          year:
            type: string
          location:
            type: string
      isActive: true
    properties:
      brand:
        type: string
      model:
        type: string
      engine:
        type: string
      year:
        type: string
      location:
        type: string
  encodingType: HASH
  columnsToEncode: []
transformation:
- alias: car_price_step_1
  description: step_1
  type: SQL
  sequenceNo: '1'
  query: SELECT * FROM car_input_port
  references:
  - alias: car_input_port
    sqlReference: car_input_port
- alias: car_price_step_2
  description: step_2
  query: SELECT * FROM car_price_step_1
  type: SQL
  sequenceNo: '2'
  references:
  - alias: car_price_step_1
    sqlReference: car_price_step_1
controlPort:
  dataQualityCheck:
    RecordCountCheck:
      inputPort:
      - referenceAlias: car_prices
        expression: "=="
        number: 100
      - referenceAlias: car_prices_csv
        expression: "<="
        number: 200
      transformation:
      - referenceAlias: trans_step
        expression: "=="
        number: 100
      - referenceAlias: trans_step
        expression: "<="
        number: 200
      productState:
        referenceAlias: car_prices_barcelona
        expression: "=="
        number: 100
    NullValueCheck:
      inputPort:
      - referenceAlias: car_prices
        checks:
        - column: id
          expression: ">="
          number: 90
        - column: name
          expression: ">="
          number: 90
    UnacceptableTextValueCheck:
      inputPort:
      - referenceAlias: car_prices
        checks:
        - column: colA
          valueList:
          - A
          - B
          - C
          number: 0.5
          expression: ">="
        - column: colA
          valueList:
          - A
          - B
          - C
          number: 0.5
          expression: ">="
      transformation:
      - referenceAlias: car_prices
        checks:
        - column: colA
          valueList:
          - A
          - B
          - C
          number: 0.5
          expression: ">="
        - column: colA
          valueList:
          - A
          - B
          - C
          number: 0.5
          expression: ">="
      productState:
        referenceAlias: car_prices_barcelona
        checks:
        - column: colA
          valueList:
          - A
          - B
          - C
          number: 0.5
          expression: ">="
        - column: colA
          valueList:
          - A
          - B
          - C
          number: 0.5
          expression: ">="
    UniqueCombinationCheck:
      inputPort:
      - referenceAlias: car_prices
        checks:
        - columns:
          - colA
          - colB
        - columns:
          - colD
          - colE
      transformation:
      - referenceAlias: trans_ref
        checks:
        - columns:
          - colA
          - colB
        - columns:
          - colD
          - colE
      productState:
        referenceAlias: car_prices_barcelona
        checks:
        - columns:
          - colA
          - colB
        - columns:
          - colA
          - colB
    DistinctValueCountCheck:
      inputPort:
      - referenceAlias: car_prices
        checks:
        - column: colA
          number: 3
          expression: ">="
        - column: colC
          number: 2
          expression: ">="
      transformation:
      - referenceAlias: trans_ref
        checks:
        - column: colA
          number: 3
          expression: ">="
        - column: colB
          number: 4
          expression: ">="
      productState:
        referenceAlias: car_prices_barcelona
        checks:
        - column: colA
          number: 3
          expression: ">="
        - column: colA
          number: 3
          expression: ">="
